(function(){var t,e,i,n,o,a,s=[].slice,r=function(t,e){return function(){return t.apply(e,arguments)}},l=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1},d={}.hasOwnProperty,u=function(t,e){function i(){this.constructor=t}for(var n in e)d.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};window.iced={Deferrals:function(){function t(t){this.continuation=t,this.count=1,this.ret=null}return t.prototype._fulfill=function(){return--this.count?void 0:this.continuation(this.ret)},t.prototype.defer=function(t){var e=this;return++this.count,function(){var i,n;return i=arguments.length>=1?s.call(arguments,0):[],null!=t&&null!=(n=t.assign_fn)&&n.apply(null,i),e._fulfill()}},t}(),findDeferral:function(){return null},trampoline:function(t){return t()}},window.__iced_k=window.__iced_k_noop=function(){},a="undefined"!=typeof exports&&null!==exports?exports:this,a.sortHelper=function(t,e){var i,n;return t.points===e.points?(i=t.text.replace(/[^a-z0-9]/gi,""),n=e.text.replace(/[^a-z0-9]/gi,""),i===n?0:i>n?1:-1):t.points>e.points?1:-1},$.isMobile=function(){return navigator.userAgent.match(/(iPhone|iPod|iPad|Android)/i)},$.getParameterByName=function(t){var e,i,n;return t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),i="[\\?&]"+t+"=([^&#]*)",e=RegExp(i),n=e.exec(window.location.search),null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))},a.SquadBuilder=function(){function t(t){this.releaseUnique=r(this.releaseUnique,this),this.claimUnique=r(this.claimUnique,this),this.onPointsUpdated=r(this.onPointsUpdated,this),this.container=$(t.container),this.faction=$.trim(t.faction),this.printable_container=$(t.printable_container),this.ships=[],this.uniques_in_use={Pilot:[],Upgrade:[],Modification:[],Title:[]},this.loading_from_serialized=!1,this.tooltipCurrentlyDisplaying=null,this.setupUI(),this.setupEventHandlers(),$.getParameterByName("f")===this.faction?this.loadFromSerialized($.getParameterByName("d")):this.addShip()}return t.prototype.setupUI=function(){var t;return this.status_container=$(document.createElement("DIV")),this.status_container.addClass("container-fluid"),this.status_container.append($.trim('<div class="span4 points-display-container">Total Points: 0</div>\n<div class="span8 pull-right button-container">\n    <div class="btn-group pull-right">\n        <button class="btn btn-info view-as-text">View as Text</button>\n        <button class="btn btn-info print-list">Print List</button>\n        <a class="btn btn-info permalink">Permalink</a>\n    </div>\n</div>')),this.container.append(this.status_container),this.points_container=$(this.status_container.find("div.points-display-container")),this.permalink=$(this.status_container.find("div.button-container a.permalink")),this.view_list_button=$(this.status_container.find("div.button-container button.view-as-text")),this.print_list_button=$(this.status_container.find("div.button-container button.print-list")),t=$(document.createElement("DIV")),t.addClass("container-fluid"),this.container.append(t),t.append($.trim('<div class="row-fluid">\n    <div class="span10 ship-container" />\n    <div class="span2 hidden-phone info-container" />\n</div>')),this.ship_container=$(t.find("div.ship-container")),this.info_container=$(t.find("div.info-container")),this.info_container.append($.trim('<div class="well info-well">\n    <h5 class="info-name"></h5>\n    <table>\n        <tbody>\n            <tr class="info-ship">\n                <td>Ship</td>\n                <td class="info-data"></td>\n            </tr>\n            <tr class="info-skill">\n                <td>Skill</td>\n                <td class="info-data info-skill"></td>\n            </tr>\n            <tr class="info-attack">\n                <td>Attack</td>\n                <td class="info-data info-attack"></td>\n            </tr>\n            <tr class="info-range">\n                <td>Range</td>\n                <td class="info-data info-range"></td>\n            </tr>\n            <tr class="info-agility">\n                <td>Agility</td>\n                <td class="info-data info-agility"></td>\n            </tr>\n            <tr class="info-hull">\n                <td>Hull</td>\n                <td class="info-data info-hull"></td>\n            </tr>\n            <tr class="info-shields">\n                <td>Shields</td>\n                <td class="info-data info-shields"></td>\n            </tr>\n            <tr class="info-actions">\n                <td>Actions</td>\n                <td class="info-data"></td>\n            </tr>\n        </tbody>\n    </table>\n    <p class="info-text" />\n</div>')),this.info_container.hide(),this.list_modal=$(document.createElement("DIV")),this.list_modal.addClass("modal hide fade text-list-modal"),$(document).append(this.list_modal),this.list_modal.append($.trim('<div class="modal-header">\n    <button type="button" class="close hide-on-print" data-dismiss="modal" aria-hidden="true">&times;</button>\n    <h3>'+this.faction+': <span class="total-points">0</span> Points </h3>\n</div>\n<div class="modal-body">\n    <ul></ul>\n</div>\n<div class="modal-footer hide-on-print">\n    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>\n</div>')),this.text_ul=$(this.list_modal.find("div.modal-body ul")),this.text_total_points_container=$(this.list_modal.find("div.modal-header span.total-points"))},t.prototype.setupEventHandlers=function(){var t=this;return this.container.on("xwing:claimUnique",function(e,i,n,o){return t.claimUnique(i,n,o)}).on("xwing:releaseUnique",function(e,i,n,o){return t.releaseUnique(i,n,o)}).on("xwing:pointsUpdated",function(e,i){return null==i&&(i=$.noop),t.onPointsUpdated(i)}),this.view_list_button.click(function(e){return e.preventDefault(),t.showTextListModal()}),this.print_list_button.click(function(e){return e.preventDefault(),t.printable_container.html(t.list_modal.html()),window.print()})},t.prototype.onPointsUpdated=function(t){var e,i,n,o,a,s,r,l,d,u,c,h,p,f,m,g;for(o=0,h=this.ships,i=s=0,d=h.length;d>s;i=++s)n=h[i],o+=n.getPoints();for(this.points_container.text("Total Points: "+o),this.text_total_points_container.text(o),this.permalink.attr("href",""+window.location.href.split("?")[0]+"?f="+encodeURI(this.faction)+"&d="+encodeURI(this.serialize())),this.text_ul.text(""),p=this.ships,r=0,u=p.length;u>r;r++)if(n=p[r],null!=n.pilot){if(n.getPoints()!==n.pilot.points){for(e="<ul>",null!=(null!=(f=n.title)?f.data:void 0)&&(e+="<li>"+(""+n.title)+"</li>"),m=n.upgrades,l=0,c=m.length;c>l;l++)a=m[l],null!=a.data&&(e+="<li>"+(""+a)+"</li>");null!=(null!=(g=n.modification)?g.data:void 0)&&(e+="<li>"+(""+n.modification)+"</li>"),e+="</ul>",o="Total: "+n.getPoints()}else o="",e="";this.text_ul.append($.trim("<li>\n    <strong>"+n.pilot.name+" ("+n.pilot.points+")</strong>\n    <br />\n    "+e+"\n    <em>"+o+"</em>\n</li>"))}return t(o)},t.prototype.showTextListModal=function(){return this.list_modal.modal("show")},t.prototype.serialize=function(){var t,e,i,n;return function(){var o,a,s,r,l,d,u,c,h,p;for(s=this.ships,p=[],o=0,a=s.length;a>o;o++)e=s[o],null!=e.pilot&&p.push(""+e.pilot.id+":"+function(){var n,o,a,s,r,l;for(a=e.pilot.slots,l=[],t=n=0,o=a.length;o>n;t=++n)i=a[t],l.push(null!=(s=null!=(r=e.upgrades[t].data)?r.id:void 0)?s:-1);return l}()+":"+(null!=(r=null!=(l=e.title)?null!=(d=l.data)?d.id:void 0:void 0)?r:-1)+":"+function(){var t,i,o,a,s,r,l,d;for(s=null!=(o=null!=(a=e.title)?a.conferredUpgrades:void 0)?o:[],d=[],t=0,i=s.length;i>t;t++)n=s[t],d.push(null!=(r=null!=(l=n.data)?l.id:void 0)?r:-1);return d}()+":"+(null!=(u=null!=(c=e.modification)?null!=(h=c.data)?h.id:void 0:void 0)?u:-1));return p}.call(this).join(";")},t.prototype.loadFromSerialized=function(t){var e,i,n,o,a,s,r,l,d,u,c,h,p,f,m,g,y,v,k;for(this.loading_from_serialized=!0;this.ships.length>0;)this.removeShip(this.ships[0]);if(this.ships.length>0)throw"Ships not emptied";for(g=t.split(";"),u=0,p=g.length;p>u;u++){for(a=g[u],y=a.split(":"),o=y[0],d=y[1],r=y[2],s=y[3],i=y[4],n=this.addShip(),n.setPilotById(parseInt(o)),v=d.split(","),e=c=0,f=v.length;f>c;e=++c)l=v[e],l=parseInt(l),l>=0&&n.upgrades[e].setById(l);if(r=parseInt(r),r>=0&&n.title.setById(r),null!=n.title&&n.title.conferredUpgrades.length>0)for(k=s.split(","),e=h=0,m=k.length;m>h;e=++h)l=k[e],l=parseInt(l),l>=0&&n.title.conferredUpgrades[e].setById(l);i=parseInt(i),i>=0&&n.modification.setById(i),n.updateSelections()}return this.loading_from_serialized=!1,this.addShip()},t.prototype.uniqueIndex=function(t,e){if(!(e in this.uniques_in_use))throw"Invalid unique type '"+e+"'";return this.uniques_in_use[e].indexOf(t)},t.prototype.claimUnique=function(t,e,i){var n,o;if(!(0>this.uniqueIndex(t,e)))throw"Unique "+e+" '"+t.name+"' already claimed";if("Pilot"===e){if(n=a.upgrades[t.name],null!=n&&null!=(null!=n?n.unique:void 0)){if(!(0>this.uniqueIndex(n,"Upgrade")))throw"Unique "+e+" '"+t.name+"' already claimed as crew";this.uniques_in_use.Upgrade.push(n)}}else if("Upgrade"===e&&"Crew"===t.slot&&(o=a.pilots[t.name],null!=o&&null!=(null!=o?o.unique:void 0))){if(!(0>this.uniqueIndex(o,"Pilot")))throw"Unique "+e+" '"+t.name+"' already claimed as pilot";this.uniques_in_use.Pilot.push(o)}return this.uniques_in_use[e].push(t),i()},t.prototype.releaseUnique=function(t,e,i){var n,o,s;if(o=this.uniqueIndex(t,e),!(o>=0))throw"Unique "+e+" '"+t.name+"' not in use";if(this.uniques_in_use[e].splice(o,1),"Pilot"===e){if(n=a.upgrades[t.name],null!=n&&null!=(null!=n?n.unique:void 0)){if(o=this.uniqueIndex(n,"Upgrade"),0>o)throw"Unique crew accompanying "+t.name+" was not also claimed!";this.uniques_in_use.Upgrade.splice(o,1)}}else if("Upgrade"===e&&"Crew"===t.slot&&(s=a.pilots[t.name],null!=s&&null!=(null!=s?s.unique:void 0))){if(o=this.uniqueIndex(s,"Pilot"),0>o)throw"Unique pilot accompanying "+t.name+" was not also claimed!";this.uniques_in_use.Pilot.splice(o,1)}return i()},t.prototype.addShip=function(){var t;return t=new i({builder:this,container:this.ship_container}),this.ships.push(t),t},t.prototype.removeShip=function(t){var e,i,n,o=this;n=__iced_k_noop,e=iced.findDeferral(arguments),function(n){i=new iced.Deferrals(n,{parent:e,funcname:"SquadBuilder.removeShip"}),t.destroy(i.defer({lineno:313})),i._fulfill()}(function(){i=new iced.Deferrals(n,{parent:e,funcname:"SquadBuilder.removeShip"}),o.container.trigger("xwing:pointsUpdated",i.defer({lineno:314})),i._fulfill()})},t.prototype.matcher=function(t,e){return t.toUpperCase().indexOf(e.toUpperCase())>=0},t.prototype.getAvailablePilotsIncluding=function(t,e){var i,n,o,s,r,d,u,c,h,p,f,m,g;for(null==e&&(e=""),u=function(){var t,o;t=a.pilots,o=[];for(n in t)i=t[n],a.ships[i.ship].faction===this.faction&&this.matcher(n,e)&&(null==i.unique||0>l.call(this.uniques_in_use.Pilot,i))&&o.push(i);return o}.call(this),null!=t&&null!=t.unique&&this.matcher(t.name,e)&&u.push(t),s={},m=function(){var t,e,n;for(n=[],t=0,e=u.length;e>t;t++)i=u[t],n.push({id:i.id,text:""+i.name+" ("+i.points+")",points:i.points,ship:i.ship});return n}(),c=0,p=m.length;p>c;c++)o=m[c],o.ship in s||(s[o.ship]=[]),s[o.ship].push(o);for(r=[],g=Object.keys(s).sort(),h=0,f=g.length;f>h;h++)d=g[h],r.push({text:d,children:s[d].sort(a.sortHelper)});return r},t.prototype.getAvailableUpgradesIncluding=function(t,e,i){var n,o,s;return null==i&&(i=""),n=function(){var e,n;e=a.upgrades,n=[];for(s in e)o=e[s],o.slot===t&&this.matcher(s,i)&&(null==o.unique||0>l.call(this.uniques_in_use.Upgrade,o))&&(null==o.faction||o.faction===this.faction)&&n.push(o);return n}.call(this),null!=e&&null!=e.unique&&this.matcher(e.name,i)&&n.push(e),function(){var t,e,i;for(i=[],t=0,e=n.length;e>t;t++)o=n[t],i.push({id:o.id,text:""+o.name+" ("+o.points+")",points:o.points});return i}().sort(a.sortHelper)},t.prototype.getAvailableModificationsIncluding=function(t,e){var i,n,o;return null==e&&(e=""),o=function(){var t,o;t=a.modifications,o=[];for(n in t)i=t[n],this.matcher(n,e)&&(null==i.unique||0>l.call(this.uniques_in_use.Modification,i))&&(null==i.faction||i.faction===this.faction)&&o.push(i);return o}.call(this),null!=t&&null!=t.unique&&this.matcher(t.name,e)&&o.push(t),function(){var t,e,n;for(n=[],t=0,e=o.length;e>t;t++)i=o[t],n.push({id:i.id,text:""+i.name+" ("+i.points+")",points:i.points});return n}().sort(a.sortHelper)},t.prototype.getAvailableTitlesIncluding=function(t,e,i){var n,o,s;return null==i&&(i=""),s=function(){var e,s;e=a.titles,s=[];for(o in e)n=e[o],n.ship===t&&this.matcher(o,i)&&0>l.call(this.uniques_in_use.Title,n)&&(null==n.faction||n.faction===this.faction)&&s.push(n);return s}.call(this),null!=e&&this.matcher(e.name,i)&&s.push(e),function(){var t,e,i;for(i=[],t=0,e=s.length;e>t;t++)n=s[t],i.push({id:n.id,text:""+n.name+" ("+n.points+")",points:n.points});return i}().sort(a.sortHelper)},t.prototype.showTooltip=function(t,e){var i;if(e!==this.tooltipCurrentlyDisplaying){switch(this.info_container.find(".info-name").text(e.name),t){case"Pilot":this.info_container.find("tr.info-ship td.info-data").text(e.ship),this.info_container.find("tr.info-ship").show(),this.info_container.find("tr.info-skill td.info-data").text(e.skill),this.info_container.find("tr.info-skill").show(),this.info_container.find("tr.info-attack td.info-data").text(a.ships[e.ship].attack),this.info_container.find("tr.info-range").hide(),this.info_container.find("tr.info-agility td.info-data").text(a.ships[e.ship].agility),this.info_container.find("tr.info-agility").show(),this.info_container.find("tr.info-hull td.info-data").text(a.ships[e.ship].hull),this.info_container.find("tr.info-hull").show(),this.info_container.find("tr.info-shields td.info-data").text(a.ships[e.ship].shields),this.info_container.find("tr.info-shields").show(),this.info_container.find("tr.info-actions td.info-data").text(a.ships[e.ship].actions.join(", ")),this.info_container.find("tr.info-actions").show(),this.info_container.find("p.info-text").text(null!=(i=e.text)?i:"");break;case"Addon":this.info_container.find("tr.info-ship").hide(),this.info_container.find("tr.info-skill").hide(),null!=e.attack?(this.info_container.find("tr.info-attack td.info-data").text(e.attack),this.info_container.find("tr.info-attack").show()):this.info_container.find("tr.info-attack").hide(),null!=e.range?(this.info_container.find("tr.info-range td.info-data").text(e.range),this.info_container.find("tr.info-range").show()):this.info_container.find("tr.info-range").hide(),this.info_container.find("tr.info-agility").hide(),this.info_container.find("tr.info-hull").hide(),this.info_container.find("tr.info-shields").hide(),this.info_container.find("tr.info-actions").hide(),this.info_container.find("p.info-text").text(e.text)}return this.info_container.show(),this.tooltipCurrentlyDisplaying=e}},t}(),i=function(){function t(t){this.builder=t.builder,this.container=t.container,this.pilot=null,this.data=null,this.upgrades=[],this.modification=null,this.title=null,this.setupUI()}return t.prototype.destroy=function(t){var e;if(this.resetPilot(),this.resetAddons(),this.teardownUI(),e=this.builder.ships.indexOf(this),0>e)throw"Ship not registered with builder";return this.builder.ships.splice(e,1),t()},t.prototype.setPilotById=function(t){return this.setPilot(a.pilotsById[parseInt(t)])},t.prototype.setPilotByName=function(t){return this.setPilot(a.pilots[$.trim(t)])},t.prototype.setPilot=function(t){var e,i,n,o,s=this;return o=__iced_k_noop,i=iced.findDeferral(arguments),t===this.pilot?o():(null==this.pilot&&(this.builder.loading_from_serialized||this.builder.addShip(),this.remove_button.fadeIn("fast")),this.resetPilot(),this.resetAddons(),this.data=a.ships[null!=t?t.ship:void 0],function(e){return null==(null!=t?t.unique:void 0)?e():(function(e){n=new iced.Deferrals(e,{parent:i,funcname:"Ship.setPilot"}),s.builder.container.trigger("xwing:claimUnique",[t,"Pilot",n.defer({lineno:443})]),n._fulfill()}(e),void 0)}(function(){var i,n,a;for(s.pilot=t,null!=s.pilot&&s.setupAddons(),s.builder.container.trigger("xwing:pointsUpdated"),a=s.row.attr("class").split(" "),i=0,n=a.length;n>i;i++)e=a[i],0===e.indexOf("ship-")&&s.row.removeClass(e);return o(s.row.addClass("ship-"+s.data.name.toLowerCase().replace(/[^a-z0-9]/gi,"")+"0"))}),void 0)},t.prototype.resetPilot=function(){var t,e,i,n=this;i=__iced_k_noop,t=iced.findDeferral(arguments),function(i){var o;return null==(null!=(o=n.pilot)?o.unique:void 0)?i():(function(i){e=new iced.Deferrals(i,{parent:t,funcname:"Ship.resetPilot"}),n.builder.container.trigger("xwing:releaseUnique",[n.pilot,"Pilot",e.defer({lineno:455})]),e._fulfill()}(i),void 0)}(function(){return n.pilot=null})},t.prototype.setupAddons=function(){var t,i,s,r,l;for(l=null!=(r=this.pilot.slots)?r:[],i=0,s=l.length;s>i;i++)t=l[i],this.upgrades.push(new o({ship:this,container:this.addon_container,slot:t}));return this.pilot.ship in a.titlesByShip&&(this.title=new n({ship:this,container:this.addon_container})),this.modification=new e({ship:this,container:this.addon_container})},t.prototype.resetAddons=function(){var t,e,i,n,o,a=this;o=__iced_k_noop,i=iced.findDeferral(arguments),function(o){var s,r,l;for(n=new iced.Deferrals(o,{parent:i,funcname:"Ship.resetAddons"}),l=a.upgrades,t=s=0,r=l.length;r>s;t=++s)e=l[t],e.destroy(n.defer({lineno:478}));null!=a.modification&&a.modification.destroy(n.defer({lineno:479})),null!=a.title&&a.title.destroy(n.defer({lineno:480})),n._fulfill()}(function(){return a.upgrades=[],a.modification=null,a.title=null})},t.prototype.getPoints=function(){var t,e,i,n,o,a,s,r,l,d,u;for(t=(null!=(o=null!=(a=this.pilot)?a.points:void 0)?o:0)+(null!=(s=null!=(r=this.modification)?r.getPoints():void 0)?s:0)+(null!=(l=null!=(d=this.title)?d.getPoints():void 0)?l:0),u=this.upgrades,i=0,n=u.length;n>i;i++)e=u[i],t+=e.getPoints();return this.points_container.text(t),null!=this.pilot&&this.points_container.show(),t},t.prototype.updateSelections=function(){var t,e,i,n;if(null==this.pilot)return this.pilot_selector.select2("data",null);for(this.pilot_selector.select2("data",{id:this.pilot.id,text:""+this.pilot.name+" ("+this.pilot.points+")"}),n=this.upgrades,e=0,i=n.length;i>e;e++)t=n[e],t.updateSelection();return null!=this.title&&this.title.updateSelection(),null!=this.modification?this.modification.updateSelection():void 0},t.prototype.setupUI=function(){var t=this;return this.row=$(document.createElement("DIV")),this.row.addClass("row-fluid"),this.container.append(this.row),this.row.append($.trim('<div class="span4 pilot-selector-container">\n    <input type="hidden" />\n</div>\n<div class="span1 points-display-container">\n    <span></span>\n</div>\n<div class="span6 addon-container" />\n<div class="span1 remove-btn-container">\n    <button class="btn btn-danger"><span class="visible-desktop visible-tablet hidden-phone">&times;</span><span class="hidden-desktop hidden-tablet visible-phone">Remove Pilot</span></button>\n</div>')),this.pilot_selector=$(this.row.find("div.pilot-selector-container input[type=hidden]")),this.pilot_selector.select2({width:"100%",placeholder:"Select a pilot",query:function(e){return e.callback({more:!1,results:t.builder.getAvailablePilotsIncluding(t.pilot,e.term)})}}),this.pilot_selector.on("change",function(){return t.setPilotById(t.pilot_selector.select2("val"))}),this.pilot_selector.data("select2").results.on("mousemove-filtered",function(e){var i;return i=$(e.target).closest(".select2-result-selectable").data("select2-data"),null!=(null!=i?i.id:void 0)?t.builder.showTooltip("Pilot",a.pilotsById[i.id]):void 0}),this.pilot_selector.data("select2").container.on("mouseover",function(){return null!=t.pilot?t.builder.showTooltip("Pilot",t.pilot):void 0}),this.points_container=$(this.row.find(".points-display-container span")),this.points_container.hide(),this.addon_container=$(this.row.find("div.addon-container")),this.remove_button=$(this.row.find("div.remove-btn-container button")),this.remove_button.click(function(e){return e.preventDefault(),t.row.slideUp("fast",function(){return t.builder.removeShip(t)})}),this.remove_button.hide()},t.prototype.teardownUI=function(){return this.row.text(""),this.row.remove()},t}(),t=function(){function t(t){this.ship=t.ship,this.container=$(t.container),this.data=null,this.type=null,this.dataByName=null,this.dataById=null}return t.prototype.destroy=function(){var t,e,i,n,o,a=this;o=__iced_k_noop,i=iced.findDeferral(arguments),e=arguments[0],t=arguments.length>=2?s.call(arguments,1):[],function(t){var e;return null==(null!=(e=a.data)?e.unique:void 0)?t():(function(t){n=new iced.Deferrals(t,{parent:i,funcname:"GenericAddon.destroy"}),a.ship.builder.container.trigger("xwing:releaseUnique",[a.data,a.type,n.defer({lineno:572})]),n._fulfill()}(t),void 0)}(function(){return a.selector.select2("destroy"),e(t)})},t.prototype.setupSelector=function(t){var e=this;return this.selector=$(document.createElement("INPUT")),this.selector.attr("type","hidden"),this.container.append(this.selector),this.selector.select2(t),this.selector.on("change",function(){return e.setById(e.selector.select2("val"))}),this.selector.data("select2").results.on("mousemove-filtered",function(t){var i;return i=$(t.target).closest(".select2-result-selectable").data("select2-data"),null!=(null!=i?i.id:void 0)?e.ship.builder.showTooltip("Addon",e.dataById[i.id]):void 0}),this.selector.data("select2").container.on("mouseover",function(){return null!=e.data?e.ship.builder.showTooltip("Addon",e.data):void 0})},t.prototype.setById=function(t){return this.setData(this.dataById[parseInt(t)])},t.prototype.setByName=function(t){return this.setData(this.dataByName[$.trim(t)])},t.prototype.setData=function(t){var e,i,n,o=this;return n=__iced_k_noop,e=iced.findDeferral(arguments),t===this.data?n():(function(t){var n;return null==(null!=(n=o.data)?n.unique:void 0)?t():(function(t){i=new iced.Deferrals(t,{parent:e,funcname:"GenericAddon.setData"}),o.ship.builder.container.trigger("xwing:releaseUnique",[o.data,o.type,i.defer({lineno:598})]),i._fulfill()}(t),void 0)}(function(){(function(n){return null==(null!=t?t.unique:void 0)?n():(function(n){i=new iced.Deferrals(n,{parent:e,funcname:"GenericAddon.setData"}),o.ship.builder.container.trigger("xwing:claimUnique",[t,o.type,i.defer({lineno:600})]),i._fulfill()}(n),void 0)})(function(){return o.data=t,n(o.ship.builder.container.trigger("xwing:pointsUpdated"))})}),void 0)},t.prototype.getPoints=function(){var t,e;return null!=(t=null!=(e=this.data)?e.points:void 0)?t:0},t.prototype.updateSelection=function(){return null!=this.data?this.selector.select2("data",{id:this.data.id,text:""+this.data.name+" ("+this.data.points+")"}):this.selector.select2("data",null)},t.prototype.toString=function(){return null!=this.data?""+this.data.name+" ("+this.data.points+")":"No "+this.type},t}(),o=function(t){function e(t){e.__super__.constructor.call(this,t),this.slot=t.slot,this.type="Upgrade",this.dataById=a.upgradesById,this.dataByName=a.upgrades,this.setupSelector()}return u(e,t),e.prototype.setupSelector=function(){var t=this;return e.__super__.setupSelector.call(this,{width:"50%",placeholder:"No "+this.slot+" Upgrade",allowClear:!0,query:function(e){return e.callback({more:!1,results:t.ship.builder.getAvailableUpgradesIncluding(t.slot,t.data,e.term)})}})},e}(t),e=function(t){function e(t){e.__super__.constructor.call(this,t),this.type="Modification",this.dataById=a.modificationsById,this.dataByName=a.modifications,this.setupSelector()}return u(e,t),e.prototype.setupSelector=function(){var t=this;return e.__super__.setupSelector.call(this,{width:"50%",placeholder:"No Modification",allowClear:!0,query:function(e){return e.callback({more:!1,results:t.ship.builder.getAvailableModificationsIncluding(t.data,e.term)})}})},e}(t),n=function(t){function e(t){e.__super__.constructor.call(this,t),this.type="Title",this.dataById=a.titlesById,this.dataByName=a.titles,this.conferredUpgrades=[],this.setupSelector()}return u(e,t),e.prototype.setData=function(t){var e,i,n,a,s,r,l=this;return r=__iced_k_noop,a=iced.findDeferral(arguments),t===this.data?r():(function(t){return null==l.data?t():(function(t){s=new iced.Deferrals(t,{parent:a,funcname:"Title.setData"}),l.ship.builder.container.trigger("xwing:releaseUnique",[l.data,"Title",s.defer({lineno:675})]),s._fulfill()}(function(){(function(t){var e,i,o;for(s=new iced.Deferrals(t,{parent:a,funcname:"Title.setData"}),o=l.conferredUpgrades,e=0,i=o.length;i>e;e++)n=o[e],n.destroy(s.defer({lineno:679}));s._fulfill()})(function(){var i,o,a;for(a=l.conferredUpgrades,i=0,o=a.length;o>i;i++)n=a[i],e=l.ship.upgrades.indexOf(n),l.ship.upgrades.splice(e,1);return t(l.conferredUpgrades=[])})}),void 0)}(function(){(function(e){return null==t?e():(function(e){s=new iced.Deferrals(e,{parent:a,funcname:"Title.setData"}),l.ship.builder.container.trigger("xwing:claimUnique",[t,"Title",s.defer({lineno:684})]),s._fulfill()}(e),void 0)})(function(){var e,a,s,d;if(l.data=t,l.ship.builder.container.trigger("xwing:pointsUpdated"),null!=(null!=(s=l.data)?s.slots:void 0)&&l.data.slots.length>0)for(d=l.data.slots,e=0,a=d.length;a>e;e++)i=d[e],n=new o({ship:l.ship,container:l.container,slot:i}),l.ship.upgrades.push(n),l.conferredUpgrades.push(n);return r()})}),void 0)},e.prototype.setupSelector=function(){var t=this;return e.__super__.setupSelector.call(this,{width:"50%",placeholder:"No Title",allowClear:!0,query:function(e){return e.callback({more:!1,results:t.ship.builder.getAvailableTitlesIncluding(t.ship.data.name,t.data,e.term)})}})},e}(t)}).call(this);