(function(){var t,e,i,o,s,n=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};s="undefined"!=typeof exports&&null!==exports?exports:this,s.sortHelper=function(t,e){var i,o;return t.points===e.points?(i=t.name.replace(/[^a-z0-9]/gi,""),o=e.name.replace(/[^a-z0-9]/gi,""),i===o?0:i>o?1:-1):t.points>e.points?1:-1},s.getParameterByName=function(t){var e,i,o;return t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),i="[\\?&]"+t+"=([^&#]*)",e=RegExp(i),o=e.exec(window.location.search),null===o?"":decodeURIComponent(o[1].replace(/\+/g," "))},$.isMobile=function(){return navigator.userAgent.match(/(iPhone|iPod|iPad|Android)/i)},s.SquadBuilder=function(){function t(t){var i,o,n=this;this.container=$(t.container),this.faction=t.faction,this.pilot_tooltip=$(t.pilot_tooltip),this.upgrade_tooltip=$(t.upgrade_tooltip),this.list_modal=$(t.list_modal),this.rows=[],this.pilots=[],this.unique_upgrades=[],this.titles=[],this.pilot_tooltip.hide(),this.upgrade_tooltip.hide(),this.status_row=$(document.createElement("DIV")),this.status_row.addClass("row"),this.container.append(this.status_row),this.points_cell=$(document.createElement("DIV")),this.points_cell.addClass("three columns total-points"),this.points_cell.text("Points: 0"),this.status_row.append(this.points_cell),o=$(document.createElement("DIV")),o.addClass("three columns permalink"),this.status_row.append(o),this.permalink=$(document.createElement("A")),this.permalink.text("Permalink"),this.permalink.attr("href","#"),o.append(this.permalink),this.button_row=$(document.createElement("DIV")),this.button_row.addClass("row"),this.container.append(this.button_row),i=$(document.createElement("DIV")),i.addClass("twelve columns"),this.button_row.append(i),this.view_list_button=$(document.createElement("BUTTON")),this.view_list_button.addClass("nice radius button"),this.view_list_button.text("View list as text"),this.view_list_button.click(function(t){return t.preventDefault(),n.list_modal.reveal()}),i.append(this.view_list_button),this.view_list_button.hide(),$(window).bind("xwing:pilotChanged",function(t,i){var o,s,a,l;for(n.pilots=function(){var t,e,i,s;for(i=this.rows,s=[],t=0,e=i.length;e>t;t++)o=i[t],null!=o.name&&""!==o.name&&s.push(o.name);return s}.call(n),l=n.rows,s=0,a=l.length;a>s;s++)o=l[s],o!==i&&o.update();return n.updatePoints(),n.pilot_tooltip.hide(),n.rows.length===n.pilots.length&&n.rows.push(new e(n)),n.updatePermalink(),n.pilots.length>0?n.view_list_button.show():n.view_list_button.hide()}),$(window).bind("xwing:upgradeChanged",function(t,e){var i,o,s,a,l,r,d,c,h,u,p,m,g,f,_;for(n.unique_upgrades=[],p=n.rows,s=0,d=p.length;d>s;s++)for(i=p[s],i.update(),m=i.upgrade_selectors,a=0,c=m.length;c>a;a++)o=m[a],null!=(null!=(g=o.upgrade)?g.unique:void 0)&&n.unique_upgrades.push(o.upgrade_name);for(f=n.rows,l=0,h=f.length;h>l;l++)for(i=f[l],_=i.upgrade_selectors,r=0,u=_.length;u>r;r++)o=_[r],o!==e&&o.update();return n.updatePoints(),n.upgrade_tooltip.hide(),n.updatePermalink()}),$(window).bind("xwing:modificationChanged",function(){return n.updatePoints(),n.upgrade_tooltip.hide(),n.updatePermalink()}),$(window).bind("xwing:titleChanged",function(){var t,e,i,o,s,a,l,r;for(n.titles=[],l=n.rows,t=i=0,s=l.length;s>i;t=++i)e=l[t],null!=e.title_selector&&n.titles.push(e.title_selector.title_name);for(r=n.rows,t=o=0,a=r.length;a>o;t=++o)e=r[t],null!=e.title_selector&&e.title_selector.update();return n.updatePoints(),n.upgrade_tooltip.hide(),n.updatePermalink()}),this.rows.push(new e(this)),s.getParameterByName("f")===this.faction&&this.loadFromSerialized(s.getParameterByName("d"))}return t.prototype.updatePoints=function(){var t,e,i,o,n,a,l,r,d,c,h,u,p,m,g,f,_,y;for(n=0,h=this.rows,l=0,d=h.length;d>l;l++){if(e=h[l],i=0,null!=e.name&&""!==e.name){for(t=parseInt(e.pilot.points),i+=t,u=e.upgrade_selectors,r=0,c=u.length;c>r;r++)o=u[r],a=parseInt(null!=(p=null!=(m=s.upgrades[o.upgrade_name])?m.points:void 0)?p:0),i+=a;i+=parseInt(null!=(g=null!=(f=s.modifications[e.modification_selector.modification_name])?f.points:void 0)?g:0),i+=parseInt(null!=(_=null!=(y=s.titles[e.title_selector.title_name])?y.points:void 0)?_:0),i!==t?(e.pilot_points_li.text("Total: "+i),e.pilot_points_li.show()):e.pilot_points_li.hide(),n+=i}e.pilot_points_cell.text(i)}return this.points_cell.text("Points: "+n),this.list_modal.find("span.total").text(n)},t.prototype.updatePermalink=function(){return this.permalink.attr("href",""+window.location.href.split("?")[0]+"?f="+encodeURI(this.faction)+"&d="+encodeURI(this.serialize()))},t.prototype.getAvailablePilots=function(){var t,e,i,o,a,l,r,d;a=function(){var t,e;t=s.ships,e=[];for(o in t)i=t[o],i.faction===this.faction&&e.push(o);return e}.call(this),l=s.pilots,d=[];for(e in l)t=l[e],r=t.ship,n.call(a,r)>=0&&(null==t.unique||0>n.call(this.pilots,e))&&0>n.call(this.unique_upgrades,e)&&d.push({name:e,points:t.points,ship:t.ship});return d},t.prototype.getAvailableUpgrades=function(t,e){var i,o;return function(){var a,l;a=s.upgrades,l=[];for(o in a)i=a[o],i.slot===t&&0>n.call(this.unique_upgrades,o)&&0>n.call(this.pilots,o)&&(null==i.faction||i.faction===this.faction)&&o!==e&&l.push({name:o,points:i.points});return l}.call(this).sort(s.sortHelper)},t.prototype.getAvailableTitles=function(t){var e,i,o,a;o=s.titles,a=[];for(i in o)e=o[i],e.ship===t&&0>n.call(this.titles,i)&&a.push({name:i,points:e.points});return a},t.prototype.showPilotInfo=function(t,e,i,o){var s,n,a,l,r,d,c,h,u,p;return null!=e&&""!==e?(this.pilot_tooltip.find(".ship td").text(i.ship),this.pilot_tooltip.find(".flavortext").text(null!=(n=i.text)?n:""),this.pilot_tooltip.find(".skill td").text(i.skill),this.pilot_tooltip.find(".attack td").text(null!=(a=null!=(l=i.ship_override)?l.attack:void 0)?a:o.attack),this.pilot_tooltip.find(".agility td").text(null!=(r=null!=(d=i.ship_override)?d.agility:void 0)?r:o.agility),this.pilot_tooltip.find(".hull td").text(null!=(c=null!=(h=i.ship_override)?h.hull:void 0)?c:o.hull),this.pilot_tooltip.find(".shields td").text(null!=(u=null!=(p=i.ship_override)?p.shields:void 0)?u:o.shields),this.pilot_tooltip.find(".actions td").text(o.actions.join(", ")),s=$(t).offset(),this.pilot_tooltip.css("width",parseInt($(t).css("width"))+"px"),this.pilot_tooltip.css("top",s.top+parseInt($(t).css("height"))+"px"),this.pilot_tooltip.css("left",s.left+"px"),this.pilot_tooltip.show()):void 0},t.prototype.showUpgradeInfo=function(t,e,i){var o;return null!=e&&""!==e?($("table.weapon-stats").hide(),null!=i.attack?(this.upgrade_tooltip.find("tr.attack").show(),this.upgrade_tooltip.find("tr.attack td").text(i.attack),$("table.weapon-stats").show()):this.upgrade_tooltip.find("tr.attack").hide(),null!=i.range?(this.upgrade_tooltip.find("tr.range").show(),this.upgrade_tooltip.find("tr.range td").text(i.range),$("table.weapon-stats").show()):this.upgrade_tooltip.find("tr.range").hide(),this.upgrade_tooltip.find(".flavortext").text(i.text),o=$(t).offset(),this.upgrade_tooltip.css("width",parseInt($(t).css("width"))+"px"),this.upgrade_tooltip.css("top",o.top+parseInt($(t).css("height"))+"px"),this.upgrade_tooltip.css("left",o.left+"px"),this.upgrade_tooltip.show()):void 0},t.prototype.serialize=function(){var t,e;return function(){var i,o,s,n,a,l,r,d,c;for(s=this.rows,c=[],i=0,o=s.length;o>i;i++)t=s[i],null!=t.name&&""!==t.name&&c.push(""+t.pilot.id+":"+function(){var i,o,s,n,a,l;for(s=t.upgrade_selectors,l=[],i=0,o=s.length;o>i;i++)e=s[i],l.push(null!=(n=null!=(a=e.upgrade)?a.id:void 0)?n:-1);return l}().join(",")+":"+(null!=(n=null!=(a=t.modification_selector.modification)?a.id:void 0)?n:-1)+":"+(null!=(l=null!=(r=t.title_selector)?null!=(d=r.title)?d.id:void 0:void 0)?l:-1));return c}.call(this).join(";")},t.prototype.loadFromSerialized=function(t){var i,o,n,a,l,r=this;for(a=this.rows,l=[],o=0,n=a.length;n>o;o++)i=a[o],l.push(i.destroy(function(){var i,o,n,a,l,d,c,h,u,p,m,g,f,_,y,k,v,w,x,T,E,b,I,A;if(1===r.rows.length){for(b=t.split(";"),w=0,T=b.length;T>w;w++){for(u=b[w],I=u.split(":"),c=I[0],k=I[1],n=I[2],g=I[3],c=parseInt(c),l=new e(r),l.pilot_selector.val(function(){var t,e;t=s.pilots,e=[];for(h in t)d=t[h],parseInt(d.id)===c&&e.push(h);return e}()[0]),l.pilot_selector.change(),A=k.split(","),i=x=0,E=A.length;E>x;i=++x)y=A[i],y=parseInt(y),y>=0&&(p=l.upgrade_selectors[i],p.selector.val(function(){var t,e;t=s.upgrades,e=[];for(v in t)_=t[v],parseInt(_.id)===y&&e.push(v);return e}()),p.selector.change());n=parseInt(n),n>=0&&(p=l.modification_selector,p.selector.val(function(){var t,e;t=s.modifications,e=[];for(a in t)o=t[a],parseInt(o.id)===n&&e.push(a);return e}()),p.selector.change()),console.log("Titles was "+r.titles),g=parseInt(g),g>=0&&(p=l.title_selector,p.selector.val(function(){var t,e;t=s.titles,e=[];for(f in t)m=t[f],parseInt(m.id)===g&&e.push(f);return e}()),p.selector.change()),console.log("Titles now "+r.titles),r.rows.push(l)}$("select").trigger("liszt:updated")}return r.rows[0].destroy(function(){return $(window).trigger("xwing:titleChanged")})}));return l},t}(),e=function(){function e(e){var n,a=this;this.builder=e,this.name=null,this.pilot=null,this.ship=null,this.upgrade_selectors=[],this.row=$(document.createElement("DIV")),this.row.addClass("row pilot"),this.builder.button_row.before(this.row),this.pilot_cell=$(document.createElement("DIV")),this.pilot_cell.addClass("four columns"),this.row.append(this.pilot_cell),this.pilot_selector=$(document.createElement("SELECT")),n=$(document.createElement("OPTION")),$.isMobile()&&(n.text("Select a pilot"),n.val(""),n.attr("disabled",!0)),this.pilot_selector.append(n),this.pilot_selector.addClass("pilot"),this.pilot_selector.attr("data-placeholder","Select a pilot"),this.pilot_selector.change(function(){var e,n,l,r,d,c,h,u,p;for(a.upgrade_cell.text(""),a.upgrade_selectors=[],a.list_ul.find("li").remove(),a.name=a.pilot_selector.val(),u=a.row.attr("class").split(" "),r=0,c=u.length;c>r;r++)e=u[r],0===e.indexOf("ship-")&&a.row.removeClass(e);if(""===a.name)a.destroy();else{for(a.pilot=s.pilots[a.name],a.ship=s.ships[a.pilot.ship],p=a.pilot.slots,d=0,h=p.length;h>d;d++)l=p[d],a.upgrade_selectors.push(new o(a,l,a.upgrade_cell));a.modification_selector=new t(a,a.upgrade_cell),a.title_selector=new i(a,a.upgrade_cell),n=function(){switch(this.pilot.ship){case"X-Wing":return"xwing1";case"Y-Wing":return"ywing0";case"A-Wing":return"awing0";case"TIE Fighter":return"tiefighter0";case"TIE Advanced":return"tieadvanced0";case"TIE Interceptor":return"tieinterceptor0";default:return null}}.call(a),null!=n&&a.row.addClass("ship-"+n),a.remove_cell.fadeIn("fast"),a.list_dd.text(""+a.name+" ("+a.pilot.points+")"),a.pilot_points_cell.show()}return $(window).trigger("xwing:pilotChanged",a)}),this.pilot_cell.append(this.pilot_selector),$.isMobile()||this.pilot_selector.chosen({search_contains:!0}),$("#"+this.pilot_selector.attr("id")+"_chzn a.chzn-single").mouseover(function(t){return a.builder.showPilotInfo($(t.delegateTarget),a.name,a.pilot,a.ship)}),$("#"+this.pilot_selector.attr("id")+"_chzn a.chzn-single").mouseleave(function(){return a.builder.pilot_tooltip.hide()}),$("#"+this.pilot_selector.attr("id")+"_chzn a.chzn-single").click(function(){return a.builder.pilot_tooltip.hide()}),this.pilot_points_cell=$(document.createElement("DIV")),this.pilot_points_cell.addClass("one column points"),this.row.append(this.pilot_points_cell),this.pilot_points_cell.hide(),this.upgrade_cell=$(document.createElement("DIV")),this.upgrade_cell.addClass("six columns upgrades"),this.row.append(this.upgrade_cell),this.remove_cell=$(document.createElement("DIV")),this.remove_cell.addClass("one column"),this.remove_cell.append('<a class="small alert radius button remove">&#215;</span>'),this.remove_cell.click(function(t){return t.preventDefault(),a.destroy()}),this.row.append(this.remove_cell),this.remove_cell.hide(),this.list_dd=$(document.createElement("DD")),this.builder.list_modal.find("dl").append(this.list_dd),this.list_dt=$(document.createElement("DT")),this.builder.list_modal.find("dl").append(this.list_dt),this.list_ul=$(document.createElement("UL")),this.list_dt.append(this.list_ul),this.pilot_points_li=$(document.createElement("SPAN")),this.pilot_points_li.addClass("points"),this.list_ul.append(this.pilot_points_li),this.pilot_points_li.hide(),this.update()}return e.prototype.update=function(){var t,e,i,o,n,a,l,r,d,c,h,u,p,m,g,f,_,y,k,v,w;for(t=this.builder.getAvailablePilots(),this.pilot&&null!=this.pilot.unique&&t.push({name:this.name,points:this.pilot.points,ship:this.pilot.ship}),l={},c=0,m=t.length;m>c;c++)n=t[c],n.ship in l||(l[n.ship]=[]),l[n.ship].push(n);for(r in l)a=l[r],a.sort(s.sortHelper);for(this.pilot_selector.text(""),e=$(document.createElement("OPTION")),$.isMobile()&&(e.text("Select a pilot"),e.val(""),e.attr("disabled",!0)),this.pilot_selector.append(e),y=Object.keys(l).sort(),h=0,g=y.length;g>h;h++)for(r=y[h],i=$(document.createElement("OPTGROUP")),i.attr("label",r),this.pilot_selector.append(i),k=l[r],u=0,f=k.length;f>u;u++)n=k[u],o=$(document.createElement("OPTION")),o.text(""+n.name+" ("+n.points+")"),o.val(n.name),i.append(o);for(this.pilot_selector.val(this.name),this.pilot_selector.trigger("liszt:updated"),v=this.upgrade_selectors,w=[],p=0,_=v.length;_>p;p++)d=v[p],w.push(d.update());return w},e.prototype.destroy=function(t){var e=this;return null==t&&(t=$.noop),this.row.slideUp("fast",function(){return e.row.remove(),e.list_dd.remove(),e.list_dt.remove(),e.list_ul.remove(),e.builder.rows.splice(e.builder.rows.indexOf(e),1),$(window).trigger("xwing:pilotChanged",null),$(window).trigger("xwing:upgradeChanged",null),t()})},e}(),o=function(){function t(t,e,i){var o,n=this;this.row=t,this.builder=this.row.builder,this.slot=e,this.upgrade_name=null,this.upgrade=null,this.selector=$(document.createElement("SELECT")),o=$(document.createElement("OPTION")),$.isMobile()&&(o.text("No "+this.slot+" Upgrade"),o.val("")),this.selector.append(o),this.selector.addClass("upgrade"),this.selector.attr("data-placeholder","Select "+this.slot+" Upgrade"),this.selector.change(function(){return n.upgrade_name=n.selector.val(),n.upgrade=s.upgrades[n.selector.val()],null!=n.upgrade_name&&""!==n.upgrade_name?(n.list_li.show(),n.list_li.text(""+n.upgrade_name+" ("+n.upgrade.points+")")):n.list_li.hide(),$(window).trigger("xwing:upgradeChanged",n.selector)}),i.append(this.selector),$.isMobile()||this.selector.chosen({search_contains:!0,allow_single_deselect:!0,disable_search_threshold:8}),$("#"+this.selector.attr("id")+"_chzn a.chzn-single").mouseover(function(t){return n.builder.showUpgradeInfo($(t.delegateTarget),n.upgrade_name,n.upgrade)}),$("#"+this.selector.attr("id")+"_chzn a.chzn-single").mouseleave(function(){return n.builder.upgrade_tooltip.hide()}),$("#"+this.selector.attr("id")+"_chzn a.chzn-single").click(function(){return n.builder.upgrade_tooltip.hide()}),this.list_li=$(document.createElement("LI")),this.row.pilot_points_li.before(this.list_li),this.list_li.hide(),this.update()}return t.prototype.update=function(){var t,e,i,o,n,a;for(t=this.builder.getAvailableUpgrades(this.slot,this.row.name),this.upgrade&&null!=this.upgrade.unique&&t.push({name:this.upgrade_name,points:this.upgrade.points}),t.sort(s.sortHelper),this.selector.text(""),e=$(document.createElement("OPTION")),$.isMobile()&&(e.text("No "+this.slot+" Upgrade"),e.val("")),this.selector.append(e),n=0,a=t.length;a>n;n++)o=t[n],i=$(document.createElement("OPTION")),i.text(""+o.name+" ("+o.points+")"),i.val(o.name),this.selector.append(i);return this.selector.val(this.upgrade_name),this.selector.trigger("liszt:updated")},t}(),t=function(){function t(t,e){var i,o=this;this.row=t,this.builder=t.builder,this.modification_name=null,this.modification=null,this.selector=$(document.createElement("SELECT")),i=$(document.createElement("OPTION")),$.isMobile()&&(i.text("No "+this.slot+" Upgrade"),i.val("")),this.selector.append(i),this.selector.addClass("modification"),this.selector.attr("data-placeholder","Select Modification"),this.selector.change(function(){return o.modification_name=o.selector.val(),o.modification=s.modifications[o.selector.val()],null!=o.modification_name&&""!==o.modification_name?(o.list_li.show(),o.list_li.text(""+o.modification_name+" ("+o.modification.points+")")):o.list_li.hide(),$(window).trigger("xwing:modificationChanged",o.selector)}),e.append(this.selector),$.isMobile()||this.selector.chosen({search_contains:!0,allow_single_deselect:!0,disable_search_threshold:8}),$("#"+this.selector.attr("id")+"_chzn a.chzn-single").mouseover(function(t){return o.builder.showUpgradeInfo($(t.delegateTarget),o.modification_name,o.modification)}),$("#"+this.selector.attr("id")+"_chzn a.chzn-single").mouseleave(function(){return o.builder.upgrade_tooltip.hide()}),$("#"+this.selector.attr("id")+"_chzn a.chzn-single").click(function(){return o.builder.upgrade_tooltip.hide()}),this.list_li=$(document.createElement("LI")),this.row.pilot_points_li.before(this.list_li),this.list_li.hide(),this.update()}return t.prototype.update=function(){var t,e,i,o,n,a,l,r;for(t=function(){var t,e;t=s.modifications,e=[];for(o in t)i=t[o],e.push({name:o,points:i.points});return e}(),t.sort(s.sortHelper),this.selector.text(""),n=$(document.createElement("OPTION")),$.isMobile()&&(n.text("No modification"),n.val("")),this.selector.append(n),l=0,r=t.length;r>l;l++)e=t[l],a=$(document.createElement("OPTION")),a.text(""+e.name+" ("+e.points+")"),a.val(e.name),this.selector.append(a);return this.selector.val(this.modification_name),this.selector.trigger("liszt:updated")},t}(),i=function(){function t(t,e){var i,o=this;this.row=t,this.builder=t.builder,this.title_name=null,this.title=null,this.selector=$(document.createElement("SELECT")),i=$(document.createElement("OPTION")),$.isMobile()&&(i.text("No "+this.slot+" Upgrade"),i.val("")),this.selector.append(i),this.selector.addClass("title"),this.selector.attr("data-placeholder","Select Title"),this.selector.change(function(){return o.title_name=o.selector.val(),o.title=s.titles[o.selector.val()],null!=o.title_name&&""!==o.title_name?(o.list_li.show(),o.list_li.text(""+o.title_name+" ("+o.title.points+")")):o.list_li.hide(),$(window).trigger("xwing:titleChanged",o.selector)}),e.append(this.selector),$.isMobile()||this.selector.chosen({search_contains:!0,allow_single_deselect:!0,disable_search_threshold:8}),$("#"+this.selector.attr("id")+"_chzn a.chzn-single").mouseover(function(t){return o.builder.showUpgradeInfo($(t.delegateTarget),o.title_name,o.title)}),$("#"+this.selector.attr("id")+"_chzn a.chzn-single").mouseleave(function(){return o.builder.upgrade_tooltip.hide()}),$("#"+this.selector.attr("id")+"_chzn a.chzn-single").click(function(){return o.builder.upgrade_tooltip.hide()}),this.list_li=$(document.createElement("LI")),this.row.pilot_points_li.before(this.list_li),this.list_li.hide(),this.update()}return t.prototype.update=function(){var t,e,i,o,n,a;for(t=this.builder.getAvailableTitles(this.row.pilot.ship),null!=this.title&&t.push({name:this.title_name,points:this.title.points}),t.sort(s.sortHelper),t.length>0?this.selector.data("chosen").container.show():this.selector.data("chosen").container.hide(),this.selector.text(""),e=$(document.createElement("OPTION")),$.isMobile()&&(e.text("No title"),e.val("")),this.selector.append(e),n=0,a=t.length;a>n;n++)o=t[n],i=$(document.createElement("OPTION")),i.text(""+o.name+" ("+o.points+")"),i.val(o.name),this.selector.append(i);return this.selector.val(this.title_name),this.selector.trigger("liszt:updated")},t}()}).call(this);