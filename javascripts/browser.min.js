(function(){var t,a,e,n,i=[].indexOf||function(t){for(var a=0,e=this.length;e>a;a++)if(a in this&&this[a]===t)return a;return-1};n="undefined"!=typeof exports&&null!==exports?exports:this,t=["pilots","upgrades","modifications","titles"],a={pilots:"Pilot",upgrades:"Upgrade",modifications:"Modification",titles:"Title"},e=function(t,a){var e,n;return e=t.name.toLowerCase().replace(/[^a-zA-Z0-9]/g,""),n=a.name.toLowerCase().replace(/[^a-zA-Z0-9]/g,""),n>e?-1:e>n?1:0},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},n.CardBrowser=function(){function s(t){this.container=$(t.container),this.currently_selected=null,this.prepareData(),this.setupUI(),this.setupHandlers(),this.renderList()}return s.prototype.setupUI=function(){return this.container.append($.trim('<div class="container-fluid xwing-card-browser">\n    <div class="row-fluid">\n        <div class="span12">\n            Sort cards by: <select class="sort-by">\n                <option value="name">Name</option>\n                <option value="type">Type</option>\n                <option value="source">Source</option>\n            </select>\n        </div>\n    </div>\n    <div class="row-fluid">\n        <div class="span4 card-selector-container">\n\n        </div>\n        <div class="span8">\n            <div class="well card-viewer-placeholder info-well">\n                <p>Select a card from the list at the left.</p>\n            </div>\n            <div class="well card-viewer-container info-well">\n                <span class="info-name"></span>\n                <br />\n                <span class="info-type"></span>\n                <br />\n                <span class="info-sources"></span>\n                <table>\n                    <tbody>\n                        <tr class="info-skill">\n                            <td>Skill</td>\n                            <td class="info-data info-skill"></td>\n                        </tr>\n                        <tr class="info-attack">\n                            <td><img class="icon-attack" src="images/transparent.png" alt="Attack" /></td>\n                            <td class="info-data info-attack"></td>\n                        </tr>\n                        <tr class="info-range">\n                            <td>Range</td>\n                            <td class="info-data info-range"></td>\n                        </tr>\n                        <tr class="info-agility">\n                            <td><img class="icon-agility" src="images/transparent.png" alt="Agility" /></td>\n                            <td class="info-data info-agility"></td>\n                        </tr>\n                        <tr class="info-hull">\n                            <td><img class="icon-hull" src="images/transparent.png" alt="Hull" /></td>\n                            <td class="info-data info-hull"></td>\n                        </tr>\n                        <tr class="info-shields">\n                            <td><img class="icon-shields" src="images/transparent.png" alt="Shields" /></td>\n                            <td class="info-data info-shields"></td>\n                        </tr>\n                        <tr class="info-actions">\n                            <td>Actions</td>\n                            <td class="info-data"></td>\n                        </tr>\n                        <tr class="info-upgrades">\n                            <td>Upgrades</td>\n                            <td class="info-data"></td>\n                        </tr>\n                    </tbody>\n                </table>\n                <p class="info-text" />\n            </div>\n        </div>\n    </div>\n</div>')),this.card_selector_container=$(this.container.find(".xwing-card-browser .card-selector-container")),this.card_viewer_container=$(this.container.find(".xwing-card-browser .card-viewer-container")),this.card_viewer_container.hide(),this.card_viewer_placeholder=$(this.container.find(".xwing-card-browser .card-viewer-placeholder")),this.sort_selector=$(this.container.find("select.sort-by")),this.sort_selector.select2({minimumResultsForSearch:-1})},s.prototype.setupHandlers=function(){var t=this;return this.sort_selector.change(function(){return t.renderList(t.sort_selector.val())})},s.prototype.prepareData=function(){var a,s,d,o,r,l,c,u,h,_,p,m,v,f,b,g,w,y,k;for(this.all_cards=[],l=0,_=t.length;_>l;l++)r=t[l],this.all_cards=this.all_cards.concat(function(){var t,a;t=n[r],a=[];for(d in t)s=t[d],a.push({name:d,type:r,data:s});return a}());for(this.all_cards.sort(e),this.sources=[],g=this.all_cards,c=0,p=g.length;p>c;c++)for(a=g[c],w=a.data.sources,u=0,m=w.length;m>u;u++)o=w[u],0>i.call(this.sources,o)&&this.sources.push(o);for(this.cards_by_type={},h=0,v=t.length;v>h;h++)r=t[h],this.cards_by_type[r]=function(){var t,e,n,i;for(n=this.all_cards,i=[],e=0,t=n.length;t>e;e++)a=n[e],a.type===r&&i.push(a);return i}.call(this).sort(e);for(this.cards_by_source={},y=this.sources,k=[],b=0,f=y.length;f>b;b++)o=y[b],k.push(this.cards_by_source[o]=function(){var t,e,n,s;for(n=this.all_cards,s=[],e=0,t=n.length;t>e;e++)a=n[e],i.call(a.data.sources,o)>=0&&s.push(a);return s}.call(this).sort(e));return k},s.prototype.renderList=function(a){var e,n,i,s,d,o,r,l,c,u,h,_,p,m,v,f,b,g,w=this;switch(null==a&&(a="name"),null!=this.card_selector&&this.card_selector.remove(),this.card_selector=$(document.createElement("SELECT")),this.card_selector.addClass("card-selector"),this.card_selector.attr("size",25),this.card_selector_container.append(this.card_selector),a){case"type":for(d=0,c=t.length;c>d;d++)for(s=t[d],n=$(document.createElement("OPTGROUP")),n.attr("label",s.capitalize()),this.card_selector.append(n),v=this.cards_by_type[s],o=0,u=v.length;u>o;o++)e=v[o],this.addCardTo(n,e);break;case"source":for(f=this.sources,r=0,h=f.length;h>r;r++)for(i=f[r],n=$(document.createElement("OPTGROUP")),n.attr("label",i.capitalize()),this.card_selector.append(n),b=this.cards_by_source[i],l=0,_=b.length;_>l;l++)e=b[l],this.addCardTo(n,e);break;default:for(g=this.all_cards,m=0,p=g.length;p>m;m++)e=g[m],this.addCardTo(this.card_selector,e)}return this.card_selector.change(function(){return w.renderCard($(w.card_selector.find(":selected")))})},s.prototype.renderCard=function(t){var e,i,s,d,o,r,l,c,u,h,_,p,m;switch(i=t.data("name"),d=t.data("type"),e=t.data("card"),this.card_viewer_container.find(".info-name").text(""+i+" ("+e.points+")"),this.card_viewer_container.find("p.info-text").html(null!=(o=e.text)?o:""),this.card_viewer_container.find(".info-sources").text(e.sources.sort().join(", ")),d){case"pilots":s=n.ships[e.ship],this.card_viewer_container.find(".info-type").text(""+e.ship+" Pilot ("+s.faction+")"),this.card_viewer_container.find("tr.info-skill td.info-data").text(e.skill),this.card_viewer_container.find("tr.info-skill").show(),this.card_viewer_container.find("tr.info-attack td.info-data").text(null!=(r=null!=(l=e.ship_override)?l.attack:void 0)?r:s.attack),this.card_viewer_container.find("tr.info-attack").show(),this.card_viewer_container.find("tr.info-range").hide(),this.card_viewer_container.find("tr.info-agility td.info-data").text(null!=(c=null!=(u=e.ship_override)?u.agility:void 0)?c:s.agility),this.card_viewer_container.find("tr.info-agility").show(),this.card_viewer_container.find("tr.info-hull td.info-data").text(null!=(h=null!=(_=e.ship_override)?_.hull:void 0)?h:s.hull),this.card_viewer_container.find("tr.info-hull").show(),this.card_viewer_container.find("tr.info-shields td.info-data").text(null!=(p=null!=(m=e.ship_override)?m.shields:void 0)?p:s.shields),this.card_viewer_container.find("tr.info-shields").show(),this.card_viewer_container.find("tr.info-actions td.info-data").text(n.ships[e.ship].actions.join(", ")),this.card_viewer_container.find("tr.info-actions").show(),this.card_viewer_container.find("tr.info-upgrades").show(),this.card_viewer_container.find("tr.info-upgrades td.info-data").text(e.slots.join(", ")||"None");break;default:switch(null!=e.faction&&this.card_viewer_container.find(".info-type").append(" &ndash; "+e.faction+" only"),this.card_viewer_container.find("tr.info-ship").hide(),this.card_viewer_container.find("tr.info-skill").hide(),null!=e.attack?(this.card_viewer_container.find("tr.info-attack td.info-data").text(e.attack),this.card_viewer_container.find("tr.info-attack").show()):this.card_viewer_container.find("tr.info-attack").hide(),null!=e.range?(this.card_viewer_container.find("tr.info-range td.info-data").text(e.range),this.card_viewer_container.find("tr.info-range").show()):this.card_viewer_container.find("tr.info-range").hide(),this.card_viewer_container.find("tr.info-agility").hide(),this.card_viewer_container.find("tr.info-hull").hide(),this.card_viewer_container.find("tr.info-shields").hide(),this.card_viewer_container.find("tr.info-actions").hide(),this.card_viewer_container.find("tr.info-upgrades").hide(),d){case"upgrades":this.card_viewer_container.find(".info-type").text(""+e.slot+" Upgrade");break;default:this.card_viewer_container.find(".info-type").text(""+a[d])}}return this.card_viewer_container.show(),this.card_viewer_placeholder.hide()},s.prototype.addCardTo=function(t,a){var e;return e=$(document.createElement("OPTION")),e.text(""+a.name+" ("+a.data.points+")"),e.data("name",a.name),e.data("type",a.type),e.data("card",a.data),$(t).append(e)},s}()}).call(this);